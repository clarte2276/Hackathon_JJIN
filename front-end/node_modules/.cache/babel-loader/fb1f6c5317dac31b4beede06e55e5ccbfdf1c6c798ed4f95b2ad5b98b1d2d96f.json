{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import CRUDHeader from'./CRUDHeader';import NavbarTop from'../../navbar/NavbarTop';import Footer from'../../Footer';import'./CRUD.css';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function UpdateNotice(){const{no}=useParams();const navigate=useNavigate();const[post,setPost]=useState({title:'',body:'',file_data:null});const[file,setFile]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[canEdit,setCanEdit]=useState(false);useEffect(()=>{axios.get(\"/notice/PostView/\".concat(no)).then(response=>{const{post}=response.data;setPost({title:post.title,body:post.content,file_data:post.file_data});setLoading(false);setCanEdit(true);}).catch(error=>{if(error.response&&error.response.status===403){alert('수정 권한이 없습니다.');navigate(\"/notice/PostView/\".concat(no));}else{console.error('게시글을 불러오는 중 오류가 발생했습니다!',error);setError('게시글을 불러오는 중 오류가 발생했습니다!');setLoading(false);}});},[no,navigate]);const onChange=event=>{const{value,name}=event.target;setPost({...post,[name]:value});};const onFileChange=event=>{setFile(event.target.files[0]);};const updatePost=async event=>{event.preventDefault();const formData=new FormData();formData.append('title',post.title);formData.append('content',post.body);if(file){formData.append('file',file);}try{await axios.post(\"/notice/PostView/\".concat(no,\"/process/update\"),formData,{withCredentials:true,headers:{'Content-Type':'multipart/form-data'}});alert('수정되었습니다.');navigate(\"/notice/PostView/\".concat(no));}catch(error){if(error.response&&error.response.status===403){alert('수정 권한이 없습니다.');navigate(\"/notice/PostView/\".concat(no));}else{console.error('게시글을 수정하는 중 오류가 발생했습니다:',error);alert('게시글을 수정하는 중 오류가 발생했습니다:');}}};const deleteFile=async()=>{try{await axios.delete(\"/notice/PostView/\".concat(no,\"/process/deleteFile\"),{withCredentials:true});setPost({...post,file_data:null});alert('파일이 삭제되었습니다.');}catch(error){console.error('파일 삭제 중 오류가 발생했습니다:',error);alert('파일 삭제 중 오류가 발생했습니다.');}};const backToList=()=>{navigate(\"/notice/PostView/\".concat(no));};if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"\\uB85C\\uB529 \\uC911...\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{children:error});}if(!canEdit){return/*#__PURE__*/_jsx(\"div\",{children:\"\\uC218\\uC815 \\uAD8C\\uD55C\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavbarTop,{}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CRUDHeader,{title:\"\\uACF5\\uC9C0\\uC0AC\\uD56D \\uAE00 \\uC218\\uC815\"})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:updatePost,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uC81C\\uBAA9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",placeholder:\"\\uC81C\\uBAA9\",value:post.title,onChange:onChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uB0B4\\uC6A9\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"body\",placeholder:\"\\uB0B4\\uC6A9\",value:post.body,onChange:onChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD604\\uC7AC \\uC5C5\\uB85C\\uB4DC\\uB41C \\uD30C\\uC77C\"}),post.file_data?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:\"data:image/jpeg;base64,\".concat(post.file_data),alt:\"Current Upload\",width:\"200\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:deleteFile,children:\"\\uD30C\\uC77C \\uC0AD\\uC81C\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"\\uC5C5\\uB85C\\uB4DC\\uB41C \\uD30C\\uC77C\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uC0C8\\uB85C\\uC6B4 \\uD30C\\uC77C \\uC5C5\\uB85C\\uB4DC\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:onFileChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:backToList,children:\"\\uCDE8\\uC18C\"}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"\\uC218\\uC815\\uD558\\uAE30\"})]}),/*#__PURE__*/_jsx(Footer,{})]});}export default UpdateNotice;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","CRUDHeader","NavbarTop","Footer","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","UpdateNotice","no","navigate","post","setPost","title","body","file_data","file","setFile","loading","setLoading","error","setError","canEdit","setCanEdit","get","concat","then","response","data","content","catch","status","alert","console","onChange","event","value","name","target","onFileChange","files","updatePost","preventDefault","formData","FormData","append","withCredentials","headers","deleteFile","delete","backToList","children","onSubmit","type","placeholder","src","alt","width","onClick"],"sources":["C:/Users/가연/Desktop/Hackathon_real/Hackathon_JJIN/front-end/src/components/notice/CRUD/UpdateNotice.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport CRUDHeader from './CRUDHeader';\r\nimport NavbarTop from '../../navbar/NavbarTop';\r\nimport Footer from '../../Footer';\r\nimport './CRUD.css';\r\nimport axios from 'axios';\r\n\r\nfunction UpdateNotice() {\r\n  const { no } = useParams();\r\n  const navigate = useNavigate();\r\n  const [post, setPost] = useState({\r\n    title: '',\r\n    body: '',\r\n    file_data: null,\r\n  });\r\n  const [file, setFile] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [canEdit, setCanEdit] = useState(false);\r\n\r\n  useEffect(() => {\r\n    axios\r\n      .get(`/notice/PostView/${no}`)\r\n      .then((response) => {\r\n        const { post } = response.data;\r\n        setPost({\r\n          title: post.title,\r\n          body: post.content,\r\n          file_data: post.file_data,\r\n        });\r\n        setLoading(false);\r\n        setCanEdit(true);\r\n      })\r\n      .catch((error) => {\r\n        if (error.response && error.response.status === 403) {\r\n          alert('수정 권한이 없습니다.');\r\n          navigate(`/notice/PostView/${no}`);\r\n        } else {\r\n          console.error('게시글을 불러오는 중 오류가 발생했습니다!', error);\r\n          setError('게시글을 불러오는 중 오류가 발생했습니다!');\r\n          setLoading(false);\r\n        }\r\n      });\r\n  }, [no, navigate]);\r\n\r\n  const onChange = (event) => {\r\n    const { value, name } = event.target;\r\n    setPost({\r\n      ...post,\r\n      [name]: value,\r\n    });\r\n  };\r\n\r\n  const onFileChange = (event) => {\r\n    setFile(event.target.files[0]);\r\n  };\r\n\r\n  const updatePost = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const formData = new FormData();\r\n    formData.append('title', post.title);\r\n    formData.append('content', post.body);\r\n    if (file) {\r\n      formData.append('file', file);\r\n    }\r\n\r\n    try {\r\n      await axios.post(`/notice/PostView/${no}/process/update`, formData, {\r\n        withCredentials: true,\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n        },\r\n      });\r\n      alert('수정되었습니다.');\r\n      navigate(`/notice/PostView/${no}`);\r\n    } catch (error) {\r\n      if (error.response && error.response.status === 403) {\r\n        alert('수정 권한이 없습니다.');\r\n        navigate(`/notice/PostView/${no}`);\r\n      } else {\r\n        console.error('게시글을 수정하는 중 오류가 발생했습니다:', error);\r\n        alert('게시글을 수정하는 중 오류가 발생했습니다:');\r\n      }\r\n    }\r\n  };\r\n\r\n  const deleteFile = async () => {\r\n    try {\r\n      await axios.delete(`/notice/PostView/${no}/process/deleteFile`, {\r\n        withCredentials: true,\r\n      });\r\n      setPost({ ...post, file_data: null });\r\n      alert('파일이 삭제되었습니다.');\r\n    } catch (error) {\r\n      console.error('파일 삭제 중 오류가 발생했습니다:', error);\r\n      alert('파일 삭제 중 오류가 발생했습니다.');\r\n    }\r\n  };\r\n\r\n  const backToList = () => {\r\n    navigate(`/notice/PostView/${no}`);\r\n  };\r\n\r\n  if (loading) {\r\n    return <div>로딩 중...</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <div>{error}</div>;\r\n  }\r\n  if (!canEdit) {\r\n    return <div>수정 권한이 없습니다.</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <NavbarTop />\r\n      <div>\r\n        <CRUDHeader title=\"공지사항 글 수정\" />\r\n      </div>\r\n      <form onSubmit={updatePost}>\r\n        <div>\r\n          <span>제목</span>\r\n          <input type=\"text\" name=\"title\" placeholder=\"제목\" value={post.title} onChange={onChange} />\r\n        </div>\r\n        <br />\r\n        <div>\r\n          <span>내용</span>\r\n          <textarea name=\"body\" placeholder=\"내용\" value={post.body} onChange={onChange}></textarea>\r\n        </div>\r\n        <br />\r\n        <div>\r\n          <span>현재 업로드된 파일</span>\r\n          {post.file_data ? (\r\n            <>\r\n              <img src={`data:image/jpeg;base64,${post.file_data}`} alt=\"Current Upload\" width=\"200\" />\r\n              <br />\r\n              <button type=\"button\" onClick={deleteFile}>\r\n                파일 삭제\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <p>업로드된 파일이 없습니다.</p>\r\n          )}\r\n        </div>\r\n        <div>\r\n          <span>새로운 파일 업로드</span>\r\n          <input type=\"file\" onChange={onFileChange} />\r\n        </div>\r\n        <br />\r\n        <button type=\"button\" onClick={backToList}>\r\n          취소\r\n        </button>\r\n        <input type=\"submit\" value=\"수정하기\" />\r\n      </form>\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default UpdateNotice;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}