{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";import io from\"socket.io-client\";import\"./Chatbot.css\";import chatbotImg from\"../images/chatbotImg.png\";import sendBtn from\"../images/sendBtn.png\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io();const aiuser=\"내꿈코\";const Chatbot=_ref=>{let{currentUser}=_ref;const[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const messagesEndRef=useRef(null);useEffect(()=>{socket.emit(\"join room\",{user:currentUser});socket.on(\"init messages\",msgs=>{setMessages(msgs);scrollToBottom();});socket.on(\"chat message\",msg=>{console.log(\"Received message: \",msg);setMessages(prevMessages=>[...prevMessages,msg]);});socket.on(\"gpt response\",msg=>{console.log(\"Received GPT response: \",msg);setMessages(prevMessages=>[...prevMessages,msg]);});return()=>{socket.off(\"chat message\");socket.off(\"init messages\");socket.off(\"gpt response\");};},[currentUser]);useEffect(()=>{scrollToBottom();},[messages]);const handleSubmit=async e=>{e.preventDefault();if(input){// 사용자 메시지 전송\nsocket.emit(\"chat message\",{text:input,user:currentUser});try{const response=await fetch(\"/ask-gpt4\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({input})});const data=await response.json();console.log(\"Server response: \",data);// GPT 응답을 내꿈코로 전송\nsocket.emit(\"gpt response\",{text:data.response,user:aiuser});setInput(\"\");}catch(error){console.error(\"Error:\",error);}}};const handleButtonClick=(label,text)=>{socket.emit(\"chat message\",{text,user:currentUser});socket.emit(\"ask chatbot\",{label});};const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};return/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-container-unique\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-bot-intro-unique\",children:[/*#__PURE__*/_jsx(\"img\",{src:chatbotImg,alt:\"chatBotprofile\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC548\\uB155\\uD558\\uC138\\uC694! \\uB3D9\\uAD6D\\uB300\\uD559\\uAD50 \\uAFC8\\uC758 \\uC694\\uC815 \\uB0B4\\uAFC8\\uCF54\\uC608\\uC6A9~!\",/*#__PURE__*/_jsx(\"br\",{}),\"\\uBE48\\uBC31 \\uC0AC\\uC6A9\\uBC95 \\uBC0F \\uC815\\uBCF4 \\uB4F1\\uC5D0 \\uB300\\uD574\\uC11C \\uAD81\\uAE08\\uD55C \\uB0B4\\uC6A9\\uC744 \\uC9C8\\uBB38\\uD558\\uBA74 \\uB2F5\\uBCC0\\uD574\\uB4DC\\uB9B4\\uAC8C\\uC694!\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chatbot-chat-messages-unique\",children:/*#__PURE__*/_jsxs(\"ul\",{id:\"chatbot-messages-unique\",children:[messages.map((msg,index)=>/*#__PURE__*/_jsx(\"li\",{className:msg.user===aiuser?\"chatbot-message-left-unique\":\"chatbot-message-right-unique\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[/*#__PURE__*/_jsxs(\"strong\",{className:msg.user===aiuser?\"nickname\":\"\",children:[msg.user,\":\"]}),\" \",msg.text]})},index)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-button-group-unique\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleButtonClick(\"TEXT 1\",\"나의 공강을 책임질 빈백의 위치를 알려줘!\"),children:\"\\uB098\\uC758 \\uACF5\\uAC15\\uC744 \\uCC45\\uC784\\uC9C8 \\uBE48\\uBC31\\uC758 \\uC704\\uCE58\\uB97C \\uC54C\\uB824\\uC918!\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleButtonClick(\"TEXT 2\",\"빈백 운영시간은 어떻게 돼?\"),children:\"\\uBE48\\uBC31 \\uC6B4\\uC601\\uC2DC\\uAC04\\uC740 \\uC5B4\\uB5BB\\uAC8C \\uB3FC?\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleButtonClick(\"TEXT 3\",\"나의 완벽한 숙면을 위해 음악을 추천해줄래?\"),children:\"\\uB098\\uC758 \\uC644\\uBCBD\\uD55C \\uC219\\uBA74\\uC744 \\uC704\\uD574 \\uC74C\\uC545\\uC744 \\uCD94\\uCC9C\\uD574\\uC904\\uB798?\"}),/*#__PURE__*/_jsxs(\"form\",{id:\"chatbot-chatform-unique\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{id:\"chatbot-messageinput-unique\",value:input,onChange:e=>setInput(e.target.value),autoComplete:\"off\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:/*#__PURE__*/_jsx(\"div\",{className:\"sendBtn\",children:/*#__PURE__*/_jsx(\"img\",{src:sendBtn,alt:\"\\uC804\\uC1A1 \\uC544\\uC774\\uCF58\"})})})]})]})]});};export default Chatbot;","map":{"version":3,"names":["React","useState","useEffect","useRef","io","chatbotImg","sendBtn","jsx","_jsx","jsxs","_jsxs","socket","aiuser","Chatbot","_ref","currentUser","messages","setMessages","input","setInput","messagesEndRef","emit","user","on","msgs","scrollToBottom","msg","console","log","prevMessages","off","handleSubmit","e","preventDefault","text","response","fetch","method","headers","body","JSON","stringify","data","json","error","handleButtonClick","label","_messagesEndRef$curre","current","scrollIntoView","behavior","className","children","src","alt","id","map","index","ref","onClick","onSubmit","value","onChange","target","autoComplete","type"],"sources":["C:/Users/가연/Desktop/Hackathon_real/Hackathon_JJIN/front-end/src/components/chat/Chatbot.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport \"./Chatbot.css\";\r\nimport chatbotImg from \"../images/chatbotImg.png\";\r\nimport sendBtn from \"../images/sendBtn.png\";\r\n\r\nconst socket = io();\r\nconst aiuser = \"내꿈코\";\r\n\r\nconst Chatbot = ({ currentUser }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const messagesEndRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    socket.emit(\"join room\", { user: currentUser });\r\n\r\n    socket.on(\"init messages\", (msgs) => {\r\n      setMessages(msgs);\r\n      scrollToBottom();\r\n    });\r\n\r\n    socket.on(\"chat message\", (msg) => {\r\n      console.log(\"Received message: \", msg);\r\n      setMessages((prevMessages) => [...prevMessages, msg]);\r\n    });\r\n\r\n    socket.on(\"gpt response\", (msg) => {\r\n      console.log(\"Received GPT response: \", msg);\r\n      setMessages((prevMessages) => [...prevMessages, msg]);\r\n    });\r\n\r\n    return () => {\r\n      socket.off(\"chat message\");\r\n      socket.off(\"init messages\");\r\n      socket.off(\"gpt response\");\r\n    };\r\n  }, [currentUser]);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (input) {\r\n      // 사용자 메시지 전송\r\n      socket.emit(\"chat message\", { text: input, user: currentUser });\r\n\r\n      try {\r\n        const response = await fetch(\"/ask-gpt4\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify({ input }),\r\n        });\r\n        const data = await response.json();\r\n        console.log(\"Server response: \", data);\r\n\r\n        // GPT 응답을 내꿈코로 전송\r\n        socket.emit(\"gpt response\", {\r\n          text: data.response,\r\n          user: aiuser,\r\n        });\r\n\r\n        setInput(\"\");\r\n      } catch (error) {\r\n        console.error(\"Error:\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleButtonClick = (label, text) => {\r\n    socket.emit(\"chat message\", { text, user: currentUser });\r\n    socket.emit(\"ask chatbot\", { label });\r\n  };\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  return (\r\n    <div className=\"chatbot-container-unique\">\r\n      <div className=\"chatbot-bot-intro-unique\">\r\n        <img src={chatbotImg} alt=\"chatBotprofile\" />\r\n        <p>\r\n          안녕하세요! 동국대학교 꿈의 요정 내꿈코예용~!\r\n          <br />\r\n          빈백 사용법 및 정보 등에 대해서 궁금한 내용을 질문하면 답변해드릴게요!\r\n        </p>\r\n      </div>\r\n      <div className=\"chatbot-chat-messages-unique\">\r\n        <ul id=\"chatbot-messages-unique\">\r\n          {messages.map((msg, index) => (\r\n            <li\r\n              key={index}\r\n              className={\r\n                msg.user === aiuser\r\n                  ? \"chatbot-message-left-unique\"\r\n                  : \"chatbot-message-right-unique\"\r\n              }\r\n            >\r\n              <div className=\"message-content\">\r\n                <strong className={msg.user === aiuser ? \"nickname\" : \"\"}>\r\n                  {msg.user}:\r\n                </strong>{\" \"}\r\n                {msg.text}\r\n              </div>\r\n            </li>\r\n          ))}\r\n          <div ref={messagesEndRef} />\r\n        </ul>\r\n      </div>\r\n      <div className=\"chatbot-button-group-unique\">\r\n        <button\r\n          onClick={() =>\r\n            handleButtonClick(\r\n              \"TEXT 1\",\r\n              \"나의 공강을 책임질 빈백의 위치를 알려줘!\"\r\n            )\r\n          }\r\n        >\r\n          나의 공강을 책임질 빈백의 위치를 알려줘!\r\n        </button>\r\n        <button\r\n          onClick={() =>\r\n            handleButtonClick(\"TEXT 2\", \"빈백 운영시간은 어떻게 돼?\")\r\n          }\r\n        >\r\n          빈백 운영시간은 어떻게 돼?\r\n        </button>\r\n        <button\r\n          onClick={() =>\r\n            handleButtonClick(\r\n              \"TEXT 3\",\r\n              \"나의 완벽한 숙면을 위해 음악을 추천해줄래?\"\r\n            )\r\n          }\r\n        >\r\n          나의 완벽한 숙면을 위해 음악을 추천해줄래?\r\n        </button>\r\n        <form id=\"chatbot-chatform-unique\" onSubmit={handleSubmit}>\r\n          <input\r\n            id=\"chatbot-messageinput-unique\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            autoComplete=\"off\"\r\n          />\r\n          <button type=\"submit\">\r\n            <div className=\"sendBtn\">\r\n              <img src={sendBtn} alt=\"전송 아이콘\"></img>\r\n            </div>\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chatbot;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}